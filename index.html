import React, { useState, useEffect, useRef } from 'react';
import { Volume2, VolumeX, Power, Camera, X, Settings } from 'lucide-react';

export default function FNAFGame() {
  const [gameState, setGameState] = useState('menu');
  const [currentView, setCurrentView] = useState('office');
  const [selectedCamera, setSelectedCamera] = useState('CAM1');
  const [power, setPower] = useState(100);
  const [hour, setHour] = useState(0);
  const [soundEnabled, setSoundEnabled] = useState(true);
  const [difficulty, setDifficulty] = useState(3);
  const [animatronicPositions, setAnimatronicPositions] = useState({
    char1: 'CAM1',
    char2: 'CAM1',
    char3: 'CAM3',
    char4: 'CAM2'
  });
  const [leftLightOn, setLeftLightOn] = useState(false);
  const [rightLightOn, setRightLightOn] = useState(false);
  const [leftDoorClosed, setLeftDoorClosed] = useState(false);
  const [rightDoorClosed, setRightDoorClosed] = useState(false);
  const [jumpscareCharacter, setJumpscareCharacter] = useState(null);
  const [showTryAgain, setShowTryAgain] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [uploadedImages, setUploadedImages] = useState({});
  const [audioContext, setAudioContext] = useState(null);
  const jumpscareTimeoutRef = useRef(null);
  const audioNodesRef = useRef([]);

  const defaultImages = {
    office_normal: '#1a1a2e',
    office_left_light: '#2d1b4e',
    office_right_light: '#4e2d1b',
    office_both_lights: '#3d2d4e',
    cam1_empty: '#0f0f1e',
    cam1_char1: '#1e0f1e',
    cam1_char2: '#1e1e0f',
    cam2: '#1e1e1e',
    cam3_empty: '#0f1e1e',
    cam3_char3: '#1e1e0f',
    jumpscare_flower: '#ff0000',
    jumpscare_green: '#00ff00',
    jumpscare_lime: '#00ff88',
    jumpscare_fire: '#ff8800'
  };

  const images = {
    office_normal: uploadedImages.office_normal || defaultImages.office_normal,
    office_left_light: uploadedImages.office_left_light || defaultImages.office_left_light,
    office_right_light: uploadedImages.office_right_light || defaultImages.office_right_light,
    office_both_lights: uploadedImages.office_both_lights || defaultImages.office_both_lights,
    cam1_empty: uploadedImages.cam1_empty || defaultImages.cam1_empty,
    cam1_char1: uploadedImages.cam1_char1 || defaultImages.cam1_char1,
    cam1_char2: uploadedImages.cam1_char2 || defaultImages.cam1_char2,
    cam2: uploadedImages.cam2 || defaultImages.cam2,
    cam3_empty: uploadedImages.cam3_empty || defaultImages.cam3_empty,
    cam3_char3: uploadedImages.cam3_char3 || defaultImages.cam3_char3,
    jumpscare_flower: uploadedImages.jumpscare_flower || defaultImages.jumpscare_flower,
    jumpscare_green: uploadedImages.jumpscare_green || defaultImages.jumpscare_green,
    jumpscare_lime: uploadedImages.jumpscare_lime || defaultImages.jumpscare_lime,
    jumpscare_fire: uploadedImages.jumpscare_fire || defaultImages.jumpscare_fire
  };

  const cameras = {
    CAM1: { name: 'Show Stage' },
    CAM2: { name: 'Dining Area' },
    CAM3: { name: 'East Hall' }
  };

  const initAudio = () => {
    if (!audioContext && soundEnabled) {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        setAudioContext(ctx);
        if (ctx.state === 'suspended') {
          ctx.resume();
        }
      } catch (e) {
        console.log('Audio not supported');
      }
    }
  };

  const cleanupAudio = () => {
    audioNodesRef.current.forEach(node => {
      try {
        if (node.stop) node.stop();
        if (node.disconnect) node.disconnect();
      } catch (e) {}
    });
    audioNodesRef.current = [];
  };

  const playJumpscareSound = () => {
    if (!soundEnabled || !audioContext) return;
    
    try {
      cleanupAudio();
      const ctx = audioContext;
      
      const bass = ctx.createOscillator();
      const bassGain = ctx.createGain();
      bass.type = 'sawtooth';
      bass.frequency.value = 50;
      bassGain.gain.setValueAtTime(2.0, ctx.currentTime);
      bassGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.5);
      bass.connect(bassGain);
      bassGain.connect(ctx.destination);
      audioNodesRef.current.push(bass, bassGain);
      
      const high = ctx.createOscillator();
      const highGain = ctx.createGain();
      high.type = 'square';
      high.frequency.value = 2000;
      highGain.gain.setValueAtTime(1.5, ctx.currentTime);
      highGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.2);
      high.connect(highGain);
      highGain.connect(ctx.destination);
      audioNodesRef.current.push(high, highGain);
      
      bass.start(ctx.currentTime);
      bass.stop(ctx.currentTime + 1.5);
      high.start(ctx.currentTime);
      high.stop(ctx.currentTime + 1.2);
    } catch (error) {
      console.log('Audio error:', error);
    }
  };

  const handleImageUpload = (imageType, event) => {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (e) => {
        setUploadedImages(prev => ({
          ...prev,
          [imageType]: e.target.result
        }));
      };
      reader.readAsDataURL(file);
    }
  };

  const playSound = (type) => {
    if (!soundEnabled || !audioContext) return;
    
    try {
      const ctx = audioContext;
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      
      switch(type) {
        case 'camera':
          oscillator.frequency.value = 800;
          gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + 0.2);
          break;
        case 'door':
          oscillator.frequency.value = 400;
          gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + 0.3);
          break;
        case 'light':
          oscillator.frequency.value = 600;
          gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + 0.1);
          break;
        case 'move':
          oscillator.frequency.value = 200;
          gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + 0.5);
          break;
      }
      
      audioNodesRef.current.push(oscillator, gainNode);
    } catch (e) {
      console.log('Sound error:', e);
    }
  };

  const StaticNoise = () => {
    const canvasRef = useRef(null);
    const frameRef = useRef(0);
    
    useEffect(() => {
      const canvas = canvasRef.current;
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
      let animationId;
      
      const drawNoise = () => {
        frameRef.current++;
        if (frameRef.current % 3 !== 0) {
          animationId = requestAnimationFrame(drawNoise);
          return;
        }
        
        const imageData = ctx.createImageData(canvas.width, canvas.height);
        const data = imageData.data;
        
        for (let i = 0; i < data.length; i += 8) {
          const value = Math.random() * 255;
          data[i] = value;
          data[i + 1] = value;
          data[i + 2] = value;
          data[i + 3] = Math.random() * 100 + 40;
        }
        
        ctx.putImageData(imageData, 0, 0);
        animationId = requestAnimationFrame(drawNoise);
      };
      
      drawNoise();
      
      return () => {
        if (animationId) cancelAnimationFrame(animationId);
      };
    }, []);
    
    return (
      <canvas 
        ref={canvasRef} 
        width={400}
        height={300}
        className="absolute inset-0 w-full h-full pointer-events-none"
        style={{ opacity: 0.25 }}
      />
    );
  };

  useEffect(() => {
    return () => {
      cleanupAudio();
      if (jumpscareTimeoutRef.current) {
        clearTimeout(jumpscareTimeoutRef.current);
      }
    };
  }, []);

  useEffect(() => {
    if (gameState !== 'playing') return;
    
    const interval = setInterval(() => {
      setPower(prev => {
        let drain = 0.15;
        if (currentView === 'camera') drain += 0.25;
        if (leftDoorClosed) drain += 0.15;
        if (rightDoorClosed) drain += 0.15;
        if (leftLightOn) drain += 0.1;
        if (rightLightOn) drain += 0.1;
        
        const newPower = Math.max(0, prev - drain);
        if (newPower === 0) {
          setGameState('gameover');
        }
        return newPower;
      });
    }, 1000);
    
    return () => clearInterval(interval);
  }, [gameState, currentView, leftDoorClosed, rightDoorClosed, leftLightOn, rightLightOn]);

  useEffect(() => {
    if (gameState !== 'playing') return;
    
    const interval = setInterval(() => {
      setHour(prev => {
        const newHour = prev + 1;
        if (newHour >= 6) {
          setGameState('win');
        }
        return newHour;
      });
    }, 90000);
    
    return () => clearInterval(interval);
  }, [gameState]);

  useEffect(() => {
    if (gameState !== 'playing') return;
    
    const interval = setInterval(() => {
      const baseMoveChance = (difficulty / 10) * (currentView === 'office' ? 0.4 : 0.15);
      
      setAnimatronicPositions(prev => {
        const updated = { ...prev };
        const characters = ['char1', 'char2', 'char3', 'char4'];
        
        characters.forEach(char => {
          if (Math.random() < baseMoveChance) {
            const currentPos = updated[char];
            
            if (currentPos === 'CAM5') {
              const jumpscareChance = 0.4 + (difficulty / 10) * 0.4;
              if (!leftDoorClosed && currentView === 'office' && Math.random() < jumpscareChance) {
                triggerJumpscare(char);
                return;
              }
              updated[char] = leftDoorClosed ? 'CAM1' : 'CAM5';
            } else if (currentPos === 'CAM6') {
              const jumpscareChance = 0.4 + (difficulty / 10) * 0.4;
              if (!rightDoorClosed && currentView === 'office' && Math.random() < jumpscareChance) {
                triggerJumpscare(char);
                return;
              }
              updated[char] = rightDoorClosed ? 'CAM1' : 'CAM6';
            } else {
              const possibleMoves = ['CAM1', 'CAM2', 'CAM3', 'CAM4', 'CAM5', 'CAM6'];
              const validMoves = possibleMoves.filter(cam => cam !== currentPos);
              updated[char] = validMoves[Math.floor(Math.random() * validMoves.length)];
              playSound('move');
            }
          }
        });
        
        return updated;
      });
    }, 6000);
    
    return () => clearInterval(interval);
  }, [gameState, currentView, leftDoorClosed, rightDoorClosed, difficulty]);

  const triggerJumpscare = (character) => {
    playJumpscareSound();
    setJumpscareCharacter(character);
    setGameState('jumpscare');
    
    jumpscareTimeoutRef.current = setTimeout(() => {
      setShowTryAgain(true);
    }, 2000);
  };

  const startGame = () => {
    initAudio();
    setGameState('playing');
    setPower(100);
    setHour(0);
    setCurrentView('office');
    setLeftDoorClosed(false);
    setRightDoorClosed(false);
    setLeftLightOn(false);
    setRightLightOn(false);
    setShowTryAgain(false);
    setJumpscareCharacter(null);
    setAnimatronicPositions({
      char1: 'CAM1',
      char2: 'CAM1',
      char3: 'CAM3',
      char4: 'CAM2'
    });
  };

  const toggleCamera = () => {
    initAudio();
    if (currentView === 'office') {
      setCurrentView('camera');
      playSound('camera');
    } else {
      setCurrentView('office');
      playSound('camera');
    }
  };

  const toggleDoor = (side) => {
    initAudio();
    playSound('door');
    if (side === 'left') {
      setLeftDoorClosed(!leftDoorClosed);
    } else {
      setRightDoorClosed(!rightDoorClosed);
    }
  };

  const toggleLight = (side) => {
    initAudio();
    playSound('light');
    if (side === 'left') {
      setLeftLightOn(!leftLightOn);
    } else {
      setRightLightOn(!rightLightOn);
    }
  };

  const getOfficeImage = () => {
    if (leftLightOn && rightLightOn) return images.office_both_lights;
    if (leftLightOn) return images.office_left_light;
    if (rightLightOn) return images.office_right_light;
    return images.office_normal;
  };

  const getJumpscareImage = () => {
    switch(jumpscareCharacter) {
      case 'char1': return images.jumpscare_flower;
      case 'char2': return images.jumpscare_green;
      case 'char3': return images.jumpscare_lime;
      case 'char4': return images.jumpscare_fire;
      default: return images.jumpscare_flower;
    }
  };

  const getCameraImage = () => {
    const animatronicsInView = Object.entries(animatronicPositions)
      .filter(([char, pos]) => pos === selectedCamera);
    
    if (selectedCamera === 'CAM1') {
      if (animatronicsInView.some(([char]) => char === 'char1')) {
        return images.cam1_char1;
      }
      if (animatronicsInView.some(([char]) => char === 'char2')) {
        return images.cam1_char2;
      }
      return images.cam1_empty;
    } else if (selectedCamera === 'CAM2') {
      return images.cam2;
    } else if (selectedCamera === 'CAM3') {
      if (animatronicsInView.some(([char]) => char === 'char3')) {
        return images.cam3_char3;
      }
      return images.cam3_empty;
    }
    return images.cam1_empty;
  };

  const renderImage = (src, alt, className = '', style = {}) => {
    if (src.startsWith('#')) {
      return (
        <div 
          className={`absolute inset-0 flex items-center justify-center ${className}`}
          style={{ backgroundColor: src, ...style }}
        >
          <div className="text-white text-4xl font-bold opacity-50">
            {alt}
          </div>
        </div>
      );
    }
    
    return (
      <img 
        src={src}
        alt={alt}
        className={`absolute inset-0 w-full h-full object-cover ${className}`}
        style={style}
        loading="eager"
      />
    );
  };

  if (gameState === 'menu') {
    return (
      <div className="w-full min-h-screen bg-black flex items-center justify-center overflow-y-auto p-4">
        <div className="text-center py-8 px-4 max-w-4xl w-full">
          <h1 className="text-4xl sm:text-6xl font-bold text-red-600 mb-4 animate-pulse">
            NIGHT SHIFT
          </h1>
          <p className="text-gray-400 mb-8 text-lg sm:text-xl">Survive Until 6 AM</p>
          <div className="space-y-4">
            <button
              onClick={startGame}
              className="block mx-auto bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-8 py-4 rounded text-xl sm:text-2xl font-bold transition-colors"
            >
              START NIGHT
            </button>
            <button
              onClick={() => setShowSettings(!showSettings)}
              className="flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 active:bg-gray-500 text-white px-8 py-3 rounded text-lg mx-auto transition-colors"
            >
              <Settings size={20} />
              Settings
            </button>
          </div>

          {showSettings && (
            <div className="mt-8 bg-gray-800 p-6 rounded-lg w-full">
              <h3 className="text-white text-xl font-bold mb-4">Settings</h3>
              
              <div className="mb-6">
                <h4 className="text-gray-300 font-bold mb-2">Difficulty</h4>
                <label className="text-gray-300 block mb-2">
                  Animatronic Activity: {difficulty}/10
                </label>
                <input
                  type="range"
                  min="1"
                  max="10"
                  value={difficulty}
                  onChange={(e) => setDifficulty(parseInt(e.target.value))}
                  className="w-full"
                />
                <p className="text-gray-400 text-sm mt-2">
                  {difficulty <= 3 && "Easy - Low jumpscare chance"}
                  {difficulty >= 4 && difficulty <= 7 && "Medium - Moderate jumpscare chance"}
                  {difficulty >= 8 && "Hard - High jumpscare chance"}
                </p>
              </div>

              <div className="border-t border-gray-700 pt-4">
                <h4 className="text-gray-300 font-bold mb-3">Upload Custom Images</h4>
                <p className="text-gray-400 text-xs mb-3">Upload your own images to customize the game</p>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                  {[
                    { key: 'office_normal', label: 'Office (Normal)' },
                    { key: 'office_left_light', label: 'Office (Left Light)' },
                    { key: 'office_right_light', label: 'Office (Right Light)' },
                    { key: 'office_both_lights', label: 'Office (Both Lights)' },
                    { key: 'cam1_empty', label: 'CAM1 (Empty)' },
                    { key: 'cam1_char1', label: 'CAM1 (Flower)' },
                    { key: 'cam1_char2', label: 'CAM1 (Fire)' },
                    { key: 'cam2', label: 'CAM2' },
                    { key: 'cam3_empty', label: 'CAM3 (Empty)' },
                    { key: 'cam3_char3', label: 'CAM3 (Shadow)' },
                    { key: 'jumpscare_flower', label: 'Jumpscare (Flower)' },
                    { key: 'jumpscare_green', label: 'Jumpscare (Green)' },
                    { key: 'jumpscare_lime', label: 'Jumpscare (Lime)' },
                    { key: 'jumpscare_fire', label: 'Jumpscare (Fire)' }
                  ].map(img => (
                    <div key={img.key} className="bg-gray-700 p-3 rounded">
                      <label className="text-gray-300 block mb-2 text-sm font-medium">{img.label}</label>
                      <input
                        type="file"
                        accept="image/*"
                        onChange={(e) => handleImageUpload(img.key, e)}
                        className="text-xs text-gray-400 w-full file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:bg-gray-600 file:text-white hover:file:bg-gray-500"
                      />
                      {uploadedImages[img.key] && (
                        <span className="text-green-400 text-xs mt-1 block">✓ Uploaded</span>
                      )}
                    </div>
                  ))}
                </div>
              </div>

              <div className="mt-6 flex justify-center">
                <button
                  onClick={() => setShowSettings(false)}
                  className="bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-6 py-2 rounded font-bold transition-colors"
                >
                  Done
                </button>
              </div>
            </div>
          )}

          <div className="mt-8">
            <button
              onClick={() => {
                setSoundEnabled(!soundEnabled);
                if (!soundEnabled) initAudio();
              }}
              className="text-gray-400 hover:text-white transition-colors p-4"
            >
              {soundEnabled ? <Volume2 size={32} /> : <VolumeX size={32} />}
            </button>
          </div>
        </div>
      </div>
    );
  }

  if (gameState === 'jumpscare') {
    const src = getJumpscareImage();
    return (
      <div className="fixed inset-0 w-screen h-screen bg-black flex items-center justify-center overflow-hidden z-50">
        {renderImage(src, 'Jumpscare', '', {
          filter: 'brightness(1.2) contrast(1.3)',
          animation: 'shake 0.05s infinite'
        })}
        
        {showTryAgain && (
          <>
            <div 
              className="absolute inset-0 bg-red-600"
              style={{ animation: 'fadeIn 1s ease-in' }}
            />
            <div className="relative z-20 text-center p-4">
              <h1 className="text-4xl sm:text-6xl font-bold text-white mb-8">
                TRY AGAIN
              </h1>
              <button
                onClick={() => {
                  setShowTryAgain(false);
                  setGameState('menu');
                  cleanupAudio();
                }}
                className="bg-white text-black px-8 py-4 rounded text-xl font-bold hover:bg-gray-200 active:bg-gray-300 transition-colors"
              >
                Back to Menu
              </button>
            </div>
          </>
        )}
        <style>{`
          @keyframes shake {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1.2); }
            10% { transform: translate(-20px, 20px) rotate(-5deg) scale(1.3); }
            20% { transform: translate(20px, -20px) rotate(5deg) scale(1.1); }
            30% { transform: translate(-20px, -20px) rotate(-3deg) scale(1.4); }
            40% { transform: translate(20px, 20px) rotate(4deg) scale(1.2); }
            50% { transform: translate(-15px, 15px) rotate(-4deg) scale(1.3); }
            60% { transform: translate(15px, -15px) rotate(3deg) scale(1.1); }
            70% { transform: translate(-15px, -15px) rotate(-5deg) scale(1.4); }
            80% { transform: translate(15px, 15px) rotate(4deg) scale(1.2); }
            90% { transform: translate(-10px, 10px) rotate(-3deg) scale(1.3); }
          }
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
        `}</style>
      </div>
    );
  }

  if (gameState === 'gameover') {
    return (
      <div className="w-full h-screen bg-black flex items-center justify-center p-4">
        <div className="text-center">
          <h1 className="text-4xl sm:text-5xl font-bold text-red-600 mb-4">POWER OUT</h1>
          <p className="text-gray-400 mb-8 text-lg sm:text-xl">You ran out of power...</p>
          <button
            onClick={() => setGameState('menu')}
            className="bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-6 py-3 rounded text-xl transition-colors"
          >
            Main Menu
          </button>
        </div>
      </div>
    );
  }

  if (gameState === 'win') {
    return (
      <div className="w-full h-screen bg-black flex items-center justify-center p-4">
        <div className="text-center">
          <h1 className="text-4xl sm:text-5xl font-bold text-green-500 mb-4">6 AM</h1>
          <p className="text-gray-400 mb-8 text-lg sm:text-xl">You survived the night!</p>
          <button
            onClick={() => setGameState('menu')}
            className="bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-6 py-3 rounded text-xl transition-colors"
          >
            Main Menu
          </button>
        </div>
      </div>
    );
  }

  if (currentView === 'office') {
    return (
      <div className="w-full h-screen bg-black relative overflow-hidden">
        {renderImage(getOfficeImage(), 'Office')}
        <StaticNoise />

        <div className="absolute top-6 left-6 text-white z-10">
          <div className="bg-black bg-opacity-75 px-4 py-3 rounded border border-white">
            <div className="flex items-center gap-2 mb-1">
              <Power size={18} />
              <span className="text-xl font-light">{Math.floor(power)}%</span>
            </div>
            <div className="text-sm font-light">{hour} AM</div>
          </div>
        </div>

        <div className="absolute left-6 top-1/2 transform -translate-y-1/2 z-10 space-y-4">
          <button
            onClick={() => toggleLight('left')}
            className="px-6 py-4 rounded border border-white font-light text-sm transition-all"
            style={{
              backgroundColor: leftLightOn ? 'rgba(255, 255, 255, 0.2)' : 'transparent',
              color: '#fff'
            }}
          >
            LIGHT
          </button>
          <button
            onClick={() => toggleDoor('left')}
            className="px-6 py-4 rounded border border-white font-light text-sm transition-all"
            style={{
              backgroundColor: 'transparent',
              color: '#fff'
            }}
          >
            DOOR<br />{leftDoorClosed ? 'CLOSED' : 'OPEN'}
          </button>
        </div>

        <div className="absolute right-6 top-1/2 transform -translate-y-1/2 z-10 space-y-4">
          <button
            onClick={() => toggleLight('right')}
            className="px-6 py-4 rounded border border-white font-light text-sm transition-all"
            style={{
              backgroundColor: rightLightOn ? 'rgba(255, 255, 255, 0.2)' : 'transparent',
              color: '#fff'
            }}
          >
            LIGHT
          </button>
          <button
            onClick={() => toggleDoor('right')}
            className="px-6 py-4 rounded border border-white font-light text-sm transition-all"
            style={{
              backgroundColor: 'transparent',
              color: '#fff'
            }}
          >
            DOOR<br />{rightDoorClosed ? 'CLOSED' : 'OPEN'}
          </button>
        </div>

        <button
          onClick={toggleCamera}
          className="absolute bottom-8 left-1/2 transform -translate-x-1/2 px-8 py-4 rounded border border-white font-light text-lg flex items-center gap-3 z-10 transition-all"
          style={{
            backgroundColor: 'transparent',
            color: '#fff'
          }}
        >
          <Camera size={20} />
          CAMERAS
        </button>
      </div>
    );
  }

  return (
    <div className="w-full h-screen bg-black relative">
      <div className="absolute inset-0 flex items-center justify-center p-8">
        <div className="w-full max-w-5xl">
          <div className="bg-black border-2 border-green-500 rounded-lg overflow-hidden aspect-video relative">
            {renderImage(getCameraImage(), `Camera ${selectedCamera}`)}
            <StaticNoise />
            
            <div className="absolute top-4 left-4 text-green-400 font-light text-lg z-20">
              {selectedCamera} - {cameras[selectedCamera].name}
            </div>
            <div className="absolute top-4 right-4 text-red-500 font-light animate-pulse z-20">
              ● REC
            </div>
          </div>
        </div>
      </div>

      <div className="absolute bottom-8 left-8 right-8">
        <div className="grid grid-cols-3 gap-4">
          {Object.keys(cameras).map(cam => (
            <button
              key={cam}
              onClick={() => {
                setSelectedCamera(cam);
                playSound('camera');
              }}
              className="p-4 rounded border transition-all font-light"
              style={{
                backgroundColor: selectedCamera === cam ? 'rgba(255, 255, 255, 0.1)' : 'transparent',
                borderColor: selectedCamera === cam ? '#fff' : '#666',
                color: selectedCamera === cam ? '#fff' : '#999'
              }}
            >
              <div className="text-base">{cam}</div>
              <div className="text-xs opacity-75">{cameras[cam].name}</div>
            </button>
          ))}
        </div>
      </div>

      <button
        onClick={toggleCamera}
        className="absolute top-6 right-6 p-3 rounded border border-white transition-all"
        style={{
          backgroundColor: 'transparent',
          color: '#fff'
        }}
      >
        <X size={24} />
      </button>

      <div className="absolute top-6 left-6 text-white">
        <div className="bg-black bg-opacity-75 px-4 py-3 rounded border border-white">
          <div className="flex items-center gap-2 mb-1">
            <Power size={18} />
            <span className="text-xl font-light">{Math.floor(power)}%</span>
          </div>
          <div className="text-sm font-light">{hour} AM</div>
        </div>
      </div>
    </div>
  );
}
